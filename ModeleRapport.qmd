---
title: "Rapport analyse de donnée"
author: 
  - name: "Manas Chloé"
  - name: "Viet Léontine"
date: "`r Sys.Date()`"
bibliography: exbiblio.bib
format: 
  pdf:
    toc: TRUE
    toc_depth: 2
    number-sections: true
    header-includes:
    - \usepackage{color}
    - \newcommand{\X}{\mathbf{X}}
execute: 
  warning: false
  message: false
  echo: false
---

```{r} 
#| echo: false

library(ggplot2)
library(corrplot)
library(FactoMineR)
library(factoextra)
library(gridExtra)
library(knitr)
library(reshape2)
gym <- read.table("DataGym3MIC.txt",header=TRUE)
gymq=gym[,-c(1,8)]


```

\vspace{1cm}



# Introduction
blabla on a un jeu de données composé de n = `r dim(gym)[1]` individus et p= `r dim(gym)[2]` variables. 
a pas oublier : identifier nature des variables qualitative nominale/ordinale, quantitative discr`ete/continue*
~nous avons fait un choix parmis les graphiques afin de rendre un rapport le plus ... possible. certain graphique n'apparaityrons pas mais sont présent dans les ficher quarto 

# analyse uni-dimensionnelle et bi-dimensionnelle

## analyse unidimensionnelle

On commence par définir les variables qualitative manuellement sur R avec *as.factor*

```{r}
#| echo: false
#| fig-cap: "résumé des 9 variables du jeu de donnée"

gym$gender<-as.factor(gym$gender)
gym$level<-factor(gym$level,labels=c("débutant","intermédiaire","expert"))
summary(gym)
 


```

### Pour une variable qualitative
Nous allons dans un premier temps nous interesser a la répartition des deux variables qualitatives: level et gender

```{r}
#| echo: false
#| fig-cap: "Distribution des effectifs selon le sexe (gauche) et le niveau de pratique (droite)"
#| label: "fig-1"
g1<-ggplot(gym, aes(x=gender))+ 
  geom_bar()
 

df <- data.frame(group = levels(gym$level),
                 value = as.vector(table(gym$level))/nrow(gym))
g2<-ggplot(df, aes(x="", y=value, fill=group))+
  geom_bar(width = 1, stat = "identity")+ 
  coord_polar("y", start=0)+ 
  theme(legend.position="bottom")

grid.arrange(g1,g2,ncol=2)

```
La @fig-1 représente deux graphique différents. Le diagramme en bâtons (à gauche) illustre la répartition de l'échantillon selon le genre.La distribution est relativement équilibrée, bien que le genre "Male" prédomine légèrement.Le diagramme en secteur (à droite), illustre la répartition proportionnelle des individus selon trois niveaux de compétence. Nous pouvons observer que les catégories "débutant" et "intermédaire" sont plus importants que "expert"

### Pour une variable quantitative

nous allons maintenant analyser les variables quantitatives du jeux de donnée.
```{r}
#| echo: false
#| fig-cap: "Distribution des variables quantitatives représenté sous forme de boxplot"
#| label: "fig-2"
gymx1<-melt(gym[,-c(1,3,4,5,7,8)])
g3=ggplot(gymx1,aes(x=variable,y=value))+
  geom_boxplot()
gymx2<-melt(gym[,-c(1,2,5,6,9)])
g5=ggplot(gymx2,aes(x=variable,y=value))+
  geom_boxplot()


g4=ggplot(gym,aes(y=calories))+
  geom_boxplot()

grid.arrange(g3,g5,g4,ncol=3)
```
Les graphiques en boîtes de la @fig-2 illustrent la tendance centrale (médiane), la dispersion (écart interquartile) ainsi que la présence de valeurs extrêmes pour plusieurs variables d'un ensemble de données. Ils permettent de souligner une forte variabilité pour le poids et les calories, et une plus grande concentration pour la taille, l'IMC et la matière grasse.

Nous allons maintenant représenter la variable Weight pour mieux observer cette disparité

```{r}
#| echo: false
#| fig-cap: "historigramme représentant la sensité en fonction du poids"
#| label: "fig-3"
ggplot(gym,aes(x=weight))+
  geom_histogram(aes(y=..density..),bins=15,color="black", fill="skyblue")+
  ggtitle("Histo. des fréquences")+
  ylab("Density")+xlab("weight")+

geom_density(color = "red", linewidth = 1) +
  labs(title = "Histogramme de Densité du Poids",
       x = "Poids (kg)",
       y = "Densité") +
  theme_minimal()
```
Sur l'histogramme de densité de la @fig-3, nous pouvons observer que la majorité des adhérents de la salle de sport a un poids compris entre 50 et 90 kg. On note également la présence de quelques personnes ayant un poids plus élevé dans l'échantillon (jusqu'à 130kg). 



## analyse bidimensionnel
### entre deux variables qualitatives

Nous nous intéressons dans cette partie a la corrélation deux variables qualitatives **level** et **gender**.

```{r} 
#| echo: false
#| fig-cap: "mosaic plots des profils lignes entre les niveaux et les genres"
#| label: "fig-4"
# Crée la table de contingence
table_gym <- table(gym$gender, gym$level)

profils_lignes <- prop.table(table_gym, margin = 1)



mosaicplot(table_gym,
           main = "Répartition de niveau par genre",
           xlab = "Proportion de niveau conditionnelle",
           ylab = "genre",
           color = TRUE,
           las = 1, 
           cex.axis = 0.8)
           

```


Dans la @fig-4, nous avons décidé de représenter la répartition de niveau par genre car il est plus pertinent que la répartition de genre par niveau.
Pour les femmes comme pour les hommes, le niveau débutant et le niveau intermédiaire sont les plus fréquents, tandis que le niveau expert est le moins fréquent. Les proportions entre débutant, intermédiaire et expert semblent suivre une tendance assez similaire pour les deux genres.

### entre une variable quantitative une variable qualitative 
```{r}
#| echo: false
#| fig-cap: "boxplot de différents variables pour chaque modalité de la variable qualitative **level**"
#| label: "fig-10"


g2=ggplot(gym,aes(x=level,y=calories))+
geom_boxplot()+
  labs(
    title = "Distribustion des calories par Niveau",
    y = "calories",
    fill = "Niveau"
  ) +
  theme_minimal()

g3=ggplot(gym,aes(x=level,y=duration))+
geom_boxplot()+
  labs(
    title = "Distribution de la durée par Niveau",
    y = "durée",
    fill = "Niveau"
  ) +
  theme_minimal()


grid.arrange (g2,g3,ncol=2)
```

La @fig-10 représente différents diagrammes en boîte (boxplots) montrant une corrélation positive et marquée entre les variables quantitatives **calories** et **duration** avec la variable qualitative **level**.
De plus nous pouvons observer dans les deux graphiques une variance plus importante chez les débutants.

Nous pouvons donc observer que plus le niveau de pratique est élevé, plus la durée de l'entraînement est longue et plus les calories brûlées sont élevées. Cela est par conséquent conforme aux attentes.

```{r}
#| echo: false

#ggplot(data=gym) +
#  geom_violin(aes(x=gender,y=fat))+
#   geom_point(aes(x=gender,y=fat), col = "blue", alpha = 0.2,position="jitter")

ggplot(data = gym) +
  geom_point(aes(x = gender, 
                 y = water, 
                
                 color = level),
             position = position_jitter(width = 0.3), 
             alpha = 0.7) +
  
 
  scale_x_discrete(name = "Genre") +
  scale_y_continuous(name = "eau") +
  labs(color = "Niveau d'Intensité",
       title = "Eau consommé selon le Niveau et le Genre")
```
Le graphique @fig-11 est un nuage de points permettant de comparer la quantité d'eau consommée pendant une séance, en fonction du genre et du niveau. La différence la plus importante est liée au genre: les hommes ont une consommation d'eau plus élevée que les femmes (entre 2 et 3,75 pour les hommes contre 1,5 à 2,75 pour les femmes).De plus, le niveau expert (bleu) est le seul niveau d'intensité qui se distingue nettement des deux autres.Il n'y a pas de tendance claire montrant que les intermédiaires consomment significativement plus que les débutants.

```{r}
#| echo: false
#| eval: false

# nuage de point qui permet d'observer les différences importantes de durée d'entrainement en fonction du niveau. Cependant on peut également noter que le genre n'influence pas cette variable
ggplot(data = gym) +
  geom_point(aes(x = gender, 
                 y = duration, 
                
                 color = level),
             position = position_jitter(width = 0.3), 
             alpha = 0.7) +
  
 
  scale_x_discrete(name = "Genre") +
  scale_y_continuous(name = "durée") +
  labs(color = "Niveau d'Intensité",
       title = "durée de l'entrainement selon le Niveau et le Genre")
```


```{r}

#| echo: false

ggplot(gym, aes(x = level, y = fat, fill = gender)) +
  
  
  geom_boxplot(position = position_dodge(0.8), width = 0.7) +
  
  labs(
    title = "Distribution du pourcentage de graisse corporelle selon le niveau et le genre",
    x = "Niveau",
    y = "Pourcentage de Graisse Corporelle (FAT)",
    fill = "Genre" # Titre de la légende de remplissage
  ) +
  
  theme_minimal() +
  
  scale_fill_manual(values = c("Female" = "#F8766D", "Male" = "#00BFC4"))

```
voir si on le garde ou pas en fonction de la longueur du rapport

### entre deux variables quantitatives

```{r}
#| echo: false
#| fig-cap: "Matrice de corrélation de Pearson entre les variables quantitatives"
#| label: "fig-5"
corrplot(cor(gymq),
         method = "ellipse",
         type = "upper",
         order = "hclust",
         title = "Matrice de Corrélation ",
         mar = c(0, 0, 1, 0), 
         tl.cex = 0.8,
         number.cex = 0.6)
```

la visualisation de la @fig-5 représente les coefficients de corrélation de Pearson entre les variables quantitatives du jeu de données.L'intensité de la couleur et l'aplatissement des ellipses sont proportionnels à la force de la corrélation.
L'association la plus forte est observée entre la durée de l'entraînement et les calories brûlées (dépendance quasi-parfaite).Nous pouvons également observer une forte corrélation positive entre l'imc et le poids.
La variable fat est fortement corrélée négativement avec duration, calories et water. 

Nous allons maintenant explorer graphiquement certaines de ces corrélations bidimensionnelles.

```{r}
#| echo: false
#| fig-cap: "Corrélation positive entre deux variables quantitatives"
#| label: "fig-f6"
g1=ggplot(gym, aes(x = duration, y = calories)) +
  geom_point(alpha = 0.6, size = 2, color = "purple") + 
  geom_smooth(method = "lm", color = "red") +         
  labs(title = "Calories brûlées en fonction de la Durée",
       x = "Durée  (h)",
       y = "Calories") 


g3=ggplot(gym, aes(x = weight, y = bmi)) +
  
  
  geom_point(alpha = 0.6, size = 2, color = "orange") +
  geom_smooth(method = "lm", color = "red") +
  labs(
    title = "Poids en fonction de l'imc",
    x = "Poids (kg)",
    y = "indice de masse coporelle (IMC)"
  ) +

  theme_minimal()


grid.arrange(g1,g3,ncol=2)

```
Dans la @fig-f6 nous pouvons observeux deux nuages de points montrant une corrélation positive et forte entre les variables.
Le graphique de gauche confirme la très forte corrélation entre les variables **duration** et **calories**. Ces observations ne sont pas étonnates car La dépense énergétique (calories) est, par définition physique, une fonction du temps. 
Le graphique de droite montre quant à lui la forte corrélation entre le poids et l'IMC.C'est une relation attendue, car le poids est un facteur déterminant dans le calcul de l'IMC (IMC = $\text{Poids} / (\text{Taille}^2)$)

```{r}
#| echo: false
#| eval: false
ggplot(gym, aes(x = duration, y = fat)) +
  geom_point(alpha = 0.6, size = 2, color = "blue") +
  geom_smooth(method = "lm") +         
  labs(title = "graisse corporel en fonction de la durée",
       x = "durée (h)",
       y = "graisse") 

```
```{r}
ggplot(gym, aes(x = fat, y = calories)) +
  geom_point(alpha = 0.6, size = 2, color = "pink") +
  geom_smooth(method = "lm", color = "darkred") +
  labs(
    title = "Graisse corporelle en fonction des calories brûlées",
    x = "Pourcentage de graisse corporelle (%)",
    y = "Calories brûlées"
  ) +
  
  theme_minimal()
```


# Statistiques multidimensionnelles

On veut à présent traiter plus de 2 variables. On considèrera les variables quantitatives pour la suite.


## analyse en composante principale (ACP)

Le principe de l'ACP est de se ramener à un espace de faible dimension en déformant le moins possible la réalité. Le nombre de dimensions initial correspond au nombre de variables quantitiatives. On va en créer des nouvelles, appelées *métavariables* ou bien *composantes principales*, inférieur en nombre.
On a la possiblité de réaliser une ACP qu'on appelle centrée ou bien centrée-réduite.

Comme son nom l'indique, la première consiste à utiliser des valeurs centrées (même moyenne à 0) et la deuxième, en plus d'avoir une moyenne à 0, réduit les valeurs pour avoir un même ordre de grandeur entre toutes les valeurs.
On utilise pour centrer et réduire la fonction *scale*.




```{r}
#on centre les valeurs

gymC<-scale(gym[,-c(1,8)],center=TRUE, scale=FALSE)
```

```{r include=FALSE}
respcaC<-PCA(gym,quali.sup=c(1,8),scale.unit = F,graph=F)
#respcaC$eig
gg1<-fviz_eig(respcaC)
gg1
   
```

```{r}

respca<-PCA(gym,quali.sup=c(1,8),scale.unit = T,graph=F)
#respca$eig
gg2<-fviz_eig(respca)
gg2

#grid.arrange(gg1,gg2,ncol=2)
```
La figure .. est centrée et la.. réduite. On remarque que dans la première, une dimension(cad une variable) s'exprime beaucoup trop et empêche la lecture des autres. Quand on réalise une ACP réduite, il devient alors possible de lire le reste des variables.
On va donc continuer l'analyse sur une ACP centrée réduite.

On observe à présent les COMPOSANTES PRINCIPALES et leur pourcentage d'inertie et inertie cumulative. On va s'intéresser aux 3 premières dimensions, car leur inertie cumulative est à 85,88%. Valeur qui nous permet de ne pas perdre beaucoup d'information, et de diminuer drastiquement la dimension des données. On pourra comparer avec une analyse avec la dim4 inluse, afin de vérifier que les informations importantes sont bien présentent dans notre modèle.

```{r}
respca$eig
```
Figure.. Graphe des individus dans le premier plan factoriel (dim1 et 2)et les suivants plans factoriels (dim1,3 et dim2,3)


```{r}
# A COMPLETER
p1<-fviz_pca_ind(respca,geom="point")
p2<-fviz_pca_ind(respca,axes=c(1,3),geom="point")
#p3<-fviz_pca_ind(respca,axes=c(2,3),geom="point")
grid.arrange(p1,p2,ncol=2)


#premier graphique comparre les variable quali, homme femme et l'autre
#et le deuxieme, en fonction du level
```
```{r}
#Axes 1 et 2
fviz_pca_ind(respca,geom="point",habillage=as.factor(gym$gender))
fviz_pca_ind(respca,geom="point",habillage=as.factor(gym$level))

#Axes 1 et 3
fviz_pca_ind(respca,axes=c(1,3),geom="point", habillage=as.factor(gym$gender))
fviz_pca_ind(respca,axes=c(1,3),geom="point", habillage=as.factor(gym$level))
```

Figure... On voit que pour une centrée tout court on ne visualise rien du tout. //à pas mettre sur rapport.
```{r}

fviz_pca_var(respca)
#fviz_pca_var(respca)
```
INTERPRÉTATIONS FINALES
PARLER PLUS DES MÉTAVARIABLES
# Références

