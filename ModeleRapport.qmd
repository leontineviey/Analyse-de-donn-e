---
title: "Rapport analyse de donnée"
author: 
  - name: "Manas Chloé"
  - name: "Viet Léontine"
date: "`r Sys.Date()`"
bibliography: exbiblio.bib
format: 
  pdf:
    toc: TRUE
    toc_depth: 2
    number-sections: true
    header-includes:
    - \usepackage{color}
    - \newcommand{\X}{\mathbf{X}}
execute: 
  warning: false
  message: false
  echo: false
---

```{r} 
#| echo: false

library(ggplot2)
library(corrplot)
library(FactoMineR)
library(factoextra)
library(clusterSim)
library(factoextra)
library(gridExtra)
library(knitr)
library(reshape2)
gym <- read.table("DataGym3MIC.txt",header=TRUE)
gymq=gym[,-c(1,8)]


```

\vspace{1cm}



# Introduction
blabla on a un jeu de données composé de n = `r dim(gym)[1]` individus et p= `r dim(gym)[2]` variables. 
a pas oublier : identifier nature des variables qualitative nominale/ordinale, quantitative discr`ete/continue*
~nous avons fait un choix parmis les graphiques afin de rendre un rapport le plus ... possible. certain graphique n'apparaityrons pas mais sont présent dans les ficher quarto 

# analyse uni-dimensionnelle et bi-dimensionnelle

## analyse unidimensionnelle

On commence par définir les variables qualitative manuellement sur R avec *as.factor*

```{r}
#| echo: false
#| fig-cap: "résumé des 9 variables du jeu de donnée"

gym$gender<-as.factor(gym$gender)
gym$level<-factor(gym$level,labels=c("débutant","intermédiaire","expert"))
summary(gym)
 


```

### Pour une variable qualitative
Nous allons dans un premier temps nous interesser a la répartition des deux variables qualitatives: level et gender

```{r}
#| echo: false
#| fig-cap: "Distribution des effectifs selon le sexe (gauche) et le niveau de pratique (droite)"
#| label: "fig-1"
g1<-ggplot(gym, aes(x=gender))+ 
  geom_bar()
 

df <- data.frame(group = levels(gym$level),
                 value = as.vector(table(gym$level))/nrow(gym))
g2<-ggplot(df, aes(x="", y=value, fill=group))+
  geom_bar(width = 1, stat = "identity")+ 
  coord_polar("y", start=0)+ 
  theme(legend.position="bottom")

grid.arrange(g1,g2,ncol=2)

```
La @fig-1 représente deux graphiques différents. Le diagramme en bâtons (à gauche) illustre la répartition de l'échantillon selon le genre. La distribution est relativement équilibrée, bien que le genre "Male" prédomine légèrement. Le diagramme en secteur (à droite), illustre la répartition proportionnelle des individus selon trois niveaux de compétence. Nous pouvons observer que les catégories "débutant" et "intermédaire" sont plus importants que "expert"

### Pour une variable quantitative

Nous allons maintenant analyser les variables quantitatives du jeux de donnée.
```{r}
#| echo: false
#| fig-cap: "Distribution des variables quantitatives représenté sous forme de boxplot"
#| label: "fig-2"
gymx1<-melt(gym[,-c(1,3,4,5,7,8)])
g3=ggplot(gymx1,aes(x=variable,y=value))+
  geom_boxplot()
gymx2<-melt(gym[,-c(1,2,5,6,9)])
g5=ggplot(gymx2,aes(x=variable,y=value))+
  geom_boxplot()


g4=ggplot(gym,aes(y=calories))+
  geom_boxplot()

grid.arrange(g3,g5,g4,ncol=3)
```
Les graphiques en boîtes de la @fig-2 illustrent la tendance centrale (médiane), la dispersion (écart interquartile) ainsi que la présence de valeurs extrêmes pour plusieurs variables d'un ensemble de données. Ils permettent de souligner une forte variabilité pour le poids et les calories, et une plus grande concentration pour la taille, l'IMC et la matière grasse.

Nous allons maintenant représenter la variable Weight pour mieux observer cette disparité

```{r}
#| echo: false
#| fig-cap: "Historigramme représentant la densité en fonction du poids"
#| label: "fig-3"
ggplot(gym,aes(x=weight))+
  geom_histogram(aes(y=..density..),bins=15,color="black", fill="skyblue")+
  ggtitle("Histo. des fréquences")+
  ylab("Density")+xlab("weight")+

geom_density(color = "red", linewidth = 1) +
  labs(title = "Histogramme de Densité du Poids",
       x = "Poids (kg)",
       y = "Densité") +
  theme_minimal()
```
Sur l'histogramme de densité de la @fig-3, nous pouvons observer que la majorité des adhérents de la salle de sport ont un poids compris entre 50 et 90 kg. On note également la présence de quelques personnes ayant un poids plus élevé dans l'échantillon (jusqu'à 130kg). 



## analyse bidimensionnel
### entre deux variables qualitatives

Nous nous intéressons dans cette partie a la corrélation des deux variables qualitatives **level** et **gender**.

```{r} 
#| echo: false
#| fig-cap: "Mosaic plots des profils lignes entre les niveaux et les genres"
#| label: "fig-4"
# Crée la table de contingence
table_gym <- table(gym$gender, gym$level)

profils_lignes <- prop.table(table_gym, margin = 1)



mosaicplot(table_gym,
           main = "Répartition de niveau par genre",
           xlab = "Proportion de niveau conditionnelle",
           ylab = "genre",
           color = TRUE,
           las = 1, 
           cex.axis = 0.8)
           

```


Dans la @fig-4, nous avons décidé de représenter la répartition de niveau par genre car il est plus pertinent que la répartition de genre par niveau.
Pour les femmes comme pour les hommes, le niveau débutant et le niveau intermédiaire sont les plus fréquents, tandis que le niveau expert est le moins fréquent. Les proportions entre débutant, intermédiaire et expert semblent suivre une tendance assez similaire pour les deux genres.

### entre une variable quantitative une variable qualitative 
```{r}
#| echo: false
#| fig-cap: "Boxplot de différentes variables pour chaque modalité de la variable qualitative **level**"
#| label: "fig-5"
g2=ggplot(gym,aes(x=level,y=calories))+
geom_boxplot()+
  labs(
    title = "Distribustion des calories par Niveau",
    y = "calories",
    fill = "Niveau"
  ) +
  theme_minimal()

g3=ggplot(gym,aes(x=level,y=duration))+
geom_boxplot()+
  labs(
    title = "Distribution de la durée par Niveau",
    y = "durée",
    fill = "Niveau"
  ) +
  theme_minimal()


grid.arrange (g2,g3,ncol=2)
```

La @fig-5 représente différents diagrammes en boîte (boxplots) montrant une corrélation positive et marquée entre les variables quantitatives **calories** et **duration** avec la variable qualitative **level**.
De plus nous pouvons observer dans les deux graphiques une variance plus importante chez les débutants.

Nous pouvons donc observer que plus le niveau de pratique est élevé, plus la durée de l'entraînement est longue et plus les calories brûlées sont élevées. Cela est par conséquent conforme aux attentes.

```{r}
#| echo: false
#| fig-cap: ""
#| label: "fig-6"
#ggplot(data=gym) +
#  geom_violin(aes(x=gender,y=fat))+
#   geom_point(aes(x=gender,y=fat), col = "blue", alpha = 0.2,position="jitter")

ggplot(data = gym) +
  geom_point(aes(x = gender, 
                 y = water, 
                
                 color = level),
             position = position_jitter(width = 0.3), 
             alpha = 0.7) +
  
 
  scale_x_discrete(name = "Genre") +
  scale_y_continuous(name = "eau") +
  labs(color = "Niveau d'Intensité",
       title = "Eau consommé selon le Niveau et le Genre")
```
Le graphique @fig-6 est un nuage de points permettant de comparer la quantité d'eau consommée pendant une séance, en fonction du genre et du niveau. La différence la plus importante est liée au genre: les hommes ont une consommation d'eau plus élevée que les femmes (entre 2 et 3,75 pour les hommes contre 1,5 à 2,75 pour les femmes).De plus, le niveau expert (bleu) est le seul niveau d'intensité qui se distingue nettement des deux autres.Il n'y a pas de tendance claire montrant que les intermédiaires consomment significativement plus que les débutants.

```{r}
#| echo: false
#| eval: false

# nuage de point qui permet d'observer les différences importantes de durée d'entrainement en fonction du niveau. Cependant on peut également noter que le genre n'influence pas cette variable
ggplot(data = gym) +
  geom_point(aes(x = gender, 
                 y = duration, 
                
                 color = level),
             position = position_jitter(width = 0.3), 
             alpha = 0.7) +
  
 
  scale_x_discrete(name = "Genre") +
  scale_y_continuous(name = "durée") +
  labs(color = "Niveau d'Intensité",
       title = "durée de l'entrainement selon le Niveau et le Genre")
```


```{r}

#| echo: false

ggplot(gym, aes(x = level, y = fat, fill = gender)) +
  
  
  geom_boxplot(position = position_dodge(0.8), width = 0.7) +
  
  labs(
    title = "Distribution du pourcentage de graisse corporelle selon le niveau et le genre",
    x = "Niveau",
    y = "Pourcentage de Graisse Corporelle (FAT)",
    fill = "Genre" # Titre de la légende de remplissage
  ) +
  
  theme_minimal() +
  
  scale_fill_manual(values = c("Female" = "#F8766D", "Male" = "#00BFC4"))

```
voir si on le garde ou pas en fonction de la longueur du rapport

### entre deux variables quantitatives

```{r}
#| echo: false
#| fig-cap: "Matrice de corrélation de Pearson entre les variables quantitatives"
#| label: "fig-7"
corrplot(cor(gymq),
         method = "ellipse",
         type = "upper",
         order = "hclust",
         title = "Matrice de Corrélation ",
         mar = c(0, 0, 1, 0), 
         tl.cex = 0.8,
         number.cex = 0.6)
```

la visualisation de la @fig-7 représente les coefficients de corrélation de Pearson entre les variables quantitatives du jeu de données.L'intensité de la couleur et l'aplatissement des ellipses sont proportionnels à la force de la corrélation.
L'association la plus forte est observée entre la durée de l'entraînement et les calories brûlées (dépendance quasi-parfaite).Nous pouvons également observer une forte corrélation positive entre l'imc et le poids.
La variable fat est fortement corrélée négativement avec duration, calories et water. 

Nous allons maintenant explorer graphiquement certaines de ces corrélations bidimensionnelles.

```{r}
#| echo: false
#| fig-cap: "Corrélation positive entre deux variables quantitatives"
#| label: "fig-8"
g1=ggplot(gym, aes(x = duration, y = calories)) +
  geom_point(alpha = 0.6, size = 2, color = "purple") + 
  geom_smooth(method = "lm", color = "red") +         
  labs(title = "Calories brûlées en fonction de la Durée",
       x = "Durée  (h)",
       y = "Calories") 


g3=ggplot(gym, aes(x = weight, y = bmi)) +
  
  
  geom_point(alpha = 0.6, size = 2, color = "orange") +
  geom_smooth(method = "lm", color = "red") +
  labs(
    title = "Poids en fonction de l'imc",
    x = "Poids (kg)",
    y = "indice de masse coporelle (IMC)"
  ) +

  theme_minimal()


grid.arrange(g1,g3,ncol=2)

```
Dans la @fig-8 nous pouvons observeux deux nuages de points montrant une corrélation positive et forte entre les variables.
Le graphique de gauche confirme la très forte corrélation entre les variables **duration** et **calories**. Ces observations ne sont pas étonnates car La dépense énergétique (calories) est, par définition physique, une fonction du temps. 
Le graphique de droite montre quant à lui la forte corrélation entre le poids et l'IMC.C'est une relation attendue, car le poids est un facteur déterminant dans le calcul de l'IMC (IMC = $\text{Poids} / (\text{Taille}^2)$)

```{r}
#| echo: false
#| eval: false
#| fig-cap: ""
#| label: "fig-9"
ggplot(gym, aes(x = duration, y = fat)) +
  geom_point(alpha = 0.6, size = 2, color = "blue") +
  geom_smooth(method = "lm") +         
  labs(title = "graisse corporel en fonction de la durée",
       x = "durée (h)",
       y = "graisse") 

```
```{r}
#| fig-cap: ""
#| label: "fig-10"
ggplot(gym, aes(x = fat, y = calories)) +
  geom_point(alpha = 0.6, size = 2, color = "pink") +
  geom_smooth(method = "lm", color = "darkred") +
  labs(
    title = "Graisse corporelle en fonction des calories brûlées",
    x = "Pourcentage de graisse corporelle (%)",
    y = "Calories brûlées"
  ) +
  
  theme_minimal()
```


# Statistiques multidimensionnelles

On s’intéresse à présent à l’analyse de jeux de données comportant plus de deux variables. Dans la suite, seules les variables quantitatives seront prises en compte.


## analyse en composante principale (ACP)

Le principe de l’analyse en composantes principales (ACP) est de représenter les données dans un espace de dimension plus faible, tout en conservant un maximum d’information issue des données initiales. # redondant : L’objectif est donc de réduire la dimension du jeu de données en limitant la perte d’information.

Initialement, le nombre de dimensions correspond au nombre de variables quantitatives observées. L’ACP permet de construire de nouvelles variables, appelées *composantes principales*. Chacune définit un axe du nouvel espace de représentation, appelé *espace factoriel*.

### Choix de la méthode d'ACP
#peut carrément réduire et expliquer en 3 phrases

Il existe deux types principaux d’ACP : centrée et centrée-réduite.

ACP centrée : les variables sont simplement centrées, c’est-à-dire que leur moyenne est ramenée à zéro.

ACP centrée-réduite : les variables sont à la fois centrées et réduites, c’est-à-dire qu’elles ont une moyenne nulle et une variance égale à 1. Cette normalisation permet de mettre toutes les variables sur un même ordre de grandeur.
#On utilise pour centrer et réduire les données la fonction *scale*.
#Dans la pratique, on utilisera directement la fonction FactoMineR de R qui réalise les ACP.




```{r}
#on centre les valeurs
gymC<-scale(gym[,-c(1,8)],center=TRUE, scale=FALSE)
```

```{r include=FALSE}
respcaC<-PCA(gym,quali.sup=c(1,8),scale.unit = F,graph=F)
#respcaC$eig
gg1<-fviz_eig(respcaC)

   
```

```{r}
#| fig-cap: " "
#| label: "fig-11"

respca<-PCA(gym,quali.sup=c(1,8),scale.unit = T,graph=F)
#respca$eig
gg2<-fviz_eig(respca)


grid.arrange(gg1,gg2,ncol=2)
```
On obtient sur la @fig-11 une ACP centrée (à gauche) et une ACP centrée-réduite (à droite). On peut observer les composantes principales générées dans les deux cas.

On remarque que, dans le cas de l’ACP centrée (à gauche), la première composante domine fortement, ce qui rend la lecture des autres composantes difficile. Ce phénomène est dû à la variable calories, dont l’échelle, comme nous l’avions déjà observée sur la @fig-2, est beaucoup plus importante que celle des autres variables. On s’attendait donc à une première composante  fortement influencée par cette variable.

Il est donc nécessaire de continuer l'étude en utilisant une ACP centrée- réduite.

### ACP centrée réduite


On s’intéresse à présent au concept d’**inertie**, notion centrale en ACP, qui permet de quantifier la quantité d’information contenue dans les données et de guider le choix du nombre de dimensions à conserver.

L’inertie totale correspond à la dispersion globale des individus et peut être décomposée en **inerties axiales**, chacune associée à une composante principale. Pour chaque axe, on calcule ainsi la **part d’inertie expliquée**, ainsi que l’**inertie cumulée**, qui mesure la proportion d’information conservée lorsque plusieurs dimensions sont prises en compte.
Dans cette étude, nous retenons les trois premières dimensions, dont l’inertie cumulée atteint 85,88 % ( @fig-12 ). Ce choix permet de conserver l’essentiel de l’information initiale tout en réduisant significativement la dimension des données, ce qui facilite leur visualisation et leur interprétation

On pourra aussi envisager d’ajouter une quatrième dimension pour vérifier que les informations importantes sont bien prises en compte dans le modèle. **À VOIR**
```{r}
#| fig-cap: " "
#| label: "fig-12"
respca$eig
```
La Figure @fig-13 représente le taux de corrélation entre les variables quantitatives initiales et les composantes principales formées. 
Ainsi le premiere axe (Dim1) sera négativement corrélé à la variable *fat* et positivement à *duration*, *calories* et *water*.
Le deuxième axe (Dim2) est positivement corrélé au *bmi* et *weight*.
**À TERMINER DE rédiger au propre et détailleé**

#fig13 weight et bmi très positivement correlé, calories duration aussi entre elles,
```{r}
#| fig-cap: " "
#| label: "fig-13"
#fviz_pca_var(respca)
#fviz_pca_var(respca,axes=c(1,3))

#| fig-cap: ""
#| label: "fig-14"
corrplot(respca$var$cor, method="ellipse")

```



**À COMPARER QUAND SÛRE DE SIGNIFICATION**

```{r}
# plans factoriels dim 1/2 et dim 1/3 et dim 2/3
#p1<-fviz_pca_ind(respca,geom="point")
#p2<-fviz_pca_ind(respca,axes=c(1,3),geom="point")
#p3<-fviz_pca_ind(respca,axes=c(2,3),geom="point")
#grid.arrange(p1,p2,ncol=2)

```

```{r}
#Axes 1 et 2
#| fig-cap: ""
#| label: "fig-15"
d1<-fviz_pca_ind(respca,geom="point",habillage=as.factor(gym$gender))
d2<-fviz_pca_ind(respca,geom="point",habillage=as.factor(gym$level))
d1
#d2 POUR COMPRENDRE LIGNE DROITE QUI VIENT D'EXPERT
#Axes 1 et 3
#| fig-cap: " "
#| label: "fig-16"
d3<-fviz_pca_ind(respca,axes=c(1,3),geom="point", habillage=as.factor(gym$gender))
d4 <- fviz_pca_ind(respca, axes=c(1,3),geom="point", habillage = as.factor(gym$level))
#d3
d4
```

Dans la Figure @fig-15, on observe la dispersion des individus selon le genre sur le plan factoriel défini par les dimensions 1 et 2. En se référant à la Figure @fig-14, on peut interpréter les tendances observées : les valeurs négatives sur la dimension 1 correspondent à des profils présentant un pourcentage de masse grasse (fat) plus élevé, tandis que les valeurs positives sur la dimension 2 sont associées à des individus ayant un poids (weight) et un indice de masse corporelle (BMI) plus importants. Les valeurs positives sur la dimension 1 sont corelées positivement à la duration de l'entraînement et les calories brulées, corelées à la fois négativement sur la dimension 2.

La coloration selon le genre met en évidence deux nuages de points de forme similaire, mais légèrement décalés le long d’une diagonale ascendante. Ce décalage suggère que les hommes ont, en moyenne, un poids et un BMI plus élevés que les femmes. À l’inverse, les femmes semblent présenter un pourcentage de masse grasse (*fat*) plus important.

La représentation met également en évidence une structure marquée le long d’une diagonale orientée vers le bas à droite, déjà présente indépendamment de la variable de coloration. Lorsque la coloration est effectuée en fonction du niveau (*level*) plutôt que du genre, on identifie plus clairement que cette structure est principalement portée par les individus experts. Ces derniers se distinguent par des séances d’entraînement plus longues et une dépense calorique plus élevée que les individus de niveau intermédiaire ou débutant. Le décalage observé traduit également des différences de pratique entre hommes et femmes, les premiers ayant tendance à s’entraîner plus longtemps et à brûler davantage de calories.

On change ensuite de plan factoriel pour analyser les dimensions 1 et 3. D’après la Figure @fig-13, la dimension 3 est fortement corrélée négativement avec la taille (*height*) et positivement avec l’indice de masse corporelle (*BMI*).

Les observations de la Figure @fig-16 apparaissent globalement moins nettes que celles du plan (Dim 1, Dim 2). Avec une coloration selon le genre, on distingue surtout une tendance des femmes à se projeter davantage vers les valeurs positives de la dimension 1, associées à des valeurs plus élevées de BMI, tandis que les hommes, en moyenne plus grands, tendent à se projeter vers le bas du graphique. Cette séparation reste toutefois peu marquée et s’explique sans doute par le fait que les hommes sont, en moyenne, plus grands que les femmes. La coloration selon le niveau apporte en revanche une lecture plus informative de ce plan factoriel, raison pour laquelle elle a été maintenue dans la présentation du rapport.

On en déduit que les individus de niveau expert suivent des entraînements de plus longue durée et présentent une dépense calorique plus élevée.  En revanche, aucun lien net n’apparaît entre la taille et le BMI dans ce plan factoriel.

On ne s’attardera pas sur le plan factoriel défini par les dimensions 2 et 3, leur inertie expliquée étant nettement plus faible que celle de la dimension 1, que l’on a donc choisi de privilégier dans l’analyse. L’ensemble des résultats obtenus apparaît par ailleurs cohérent avec les interprétations précédentes et les relations mises en évidence entre les variables.

# Clustering

## K-means
## Classification hiérarchique

La classification hiérachique est une méthode de clustering qui regroupe progressivement les individus par similitudes.

Nous allons dans un permier temps comparer visuellement 3 critères différentes pour mesurer les distances entre 2 groupes différentes. Il existe 3 types de liens entre les classes: 
Lien simple (single) : Relie les voisins les plus proches.

Lien complet (complete) : Crée des classes compactes.

Lien moyen (average) : Un compromis entre les deux.

```{r}
#| echo: false
#| eval: false
#| fig-cap: "Comparaison de 3 dendogrammes"
#| label: "fig-20"
set.seed(1234)
hclustsingle<-hclust(dist(gymq,method="euclidean"), method = "single", members = NULL)
hclustcomplete<-hclust(dist(gymq,method="euclidean"),method = "complete", members = NULL)
hclustaverage<-hclust(dist(gymq,method="euclidean"),method = "average", members = NULL)

# Dendrogramme
plot(hclustsingle,labels=FALSE,hang=-1)
plot(hclustcomplete,labels=FALSE,hang=-1)
plot(hclustaverage,labels=FALSE,hang=-1)

#fviz_dend(hclustsingle,show_labels=FALSE)
#fviz_dend(hclustcomplete,show_labels=FALSE)
#fviz_dend(hclustaverage,show_labels=FALSE)
```
La @fig-20 permet de visualiser 3 dendogrammes utilisant chacun un type de lien différent... A ANALYSER



Nous allons maintenant utiliser la mesure d'agrégation de Ward.L'objectif de cette méthode est de limiter au maximum l'inertie intraclasse à chaque regroupement. Progressivement, les objets sont agglomérés les uns aux autres en respectant ce critère jusqu’à ce que le nombre de cluster souhaité soit atteint. Cette méthode est souvent utilisée car elle permet de creer des groupes homogènes.

```{r}
hward<-hclust(dist(gymq), method = "ward.D2", members = NULL)
fviz_dend(hward,show_labels=FALSE)

```

Nous allons maintenant déterminer le nombre de classes.
Il existe différentes critères pour choisir le nombre optimal de cluster: R-Square, Calinski-Harabasz, silhouette, Gap Statistique ... 
Nous allons utiliser l'indice de Calinski-Harabasz et celui de la Silhouette.


```{r}
fviz_nbclust(gymq, hcut, method = "silhouette") +
  labs(subtitle = "Critère de la Silhouette")


CH<-NULL
Kmax<-20
for (k in 2:Kmax){
  CH<-c(CH,index.G1(x=gymq, cl=cutree(hward,k=k)))
}
daux<-data.frame(NbClust=2:Kmax,CH=CH)
ggplot(daux,aes(x=NbClust,y=CH))+
  geom_line()+
  geom_point()

Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(gym),ncol=Kmax-1)
Iintra<-NULL
for (k in 2:Kmax){
  resaux<-kmeans(gymq,centers=k)
  reskmeanscl[,k-1]<-resaux$cluster
  Iintra<-c(Iintra,resaux$tot.withinss)
}

df<-data.frame(K=2:15,Iintra=Iintra)
ggplot(df,aes(x=K,y=Iintra))+
  geom_line()+
  geom_point()+
  xlab("Nombre de classes")+
  ylab("Inertie intraclasse")

ClustCH<-cutree(hward,k=5)

```
 
```{r}

data_cr <- scale(gymq, center = TRUE, scale = TRUE) 
inertie_totale <- sum(data_cr^2)

r_carre <- numeric(10) # Créer un vecteur vide

for (k in 1:10) {
  groupes <- cutree(hward, k = k)
  
  inertie_intra <- 0
  for (g in 1:k) {
    sub_data <- data_cr[groupes == g, , drop=FALSE]
    if(nrow(sub_data) > 1) {
       inertie_intra <- inertie_intra + sum((t(t(sub_data) - colMeans(sub_data)))^2)
    }
  }
  
  r_carre[k] <- (inertie_totale - inertie_intra) / inertie_totale
}


df_r2 <- data.frame(NbClust = 1:10, R_carre = r_carre)

ggplot(df_r2, aes(x = NbClust, y = R_carre)) +
  geom_line() +                        
  geom_point() +                     
  labs(x = "Nombre de classes (k)",    
       y = "R-carré",                  
       title = "Évolution du R-carré selon le nombre de classes") +
  theme_minimal()
```

Une fois que l'on a choisi le nombre de cluster, nous allons observer la distribusion des variables par classe.

```{r}
#| echo: false
#| eval: false
k=3
fviz_dend(hward,k)

df<-data.frame(gymq,Class=as.factor(a))
df<-melt(df,id="Class")
ggplot(df,aes(x=variable,y=value))+
  facet_wrap(~variable, scales = "free") +
  geom_violin(aes(fill=Class))

#a=cutree(hward,k)
#print("Croisement avec le niveau :")
#table(gym$level,a)
#print("Croisement avec le genre :")
#table(gym$gender,a)
```



### comparaison des méthodes de clustering
# Références

