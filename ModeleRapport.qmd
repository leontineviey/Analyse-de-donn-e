---
title: "Rapport analyse de donnée"
author: 
  - name: "Manas Chloé"
  - name: "Viet Léontine"
date: "`r Sys.Date()`"
bibliography: exbiblio.bib
format: 
  pdf:
    toc: TRUE
    toc_depth: 2
    number-sections: true
    header-includes:
    - \usepackage{color}
    - \newcommand{\X}{\mathbf{X}}
execute: 
  warning: false
  message: false
  echo: false
---

```{r} 
#| echo: false

library(ggplot2)
library(corrplot)
library(FactoMineR)
library(factoextra)
library(gridExtra)
library(knitr)
library(reshape2)
gym <- read.table("DataGym3MIC.txt",header=TRUE)
gymq=gym[,-c(1,8)]


```

\vspace{1cm}



# Introduction
blabla on a un jeu de données composé de n = `r dim(gym)[1]` individus et p= `r dim(gym)[2]` variables. 

# analyse uni-dimensionnelle et bi-dimensionnelle

## analyse unidimensionnelle

On commence par définir les variables qualitative manuellement sur R avec as.factor

```{r}
#| echo: false

gym$gender<-as.factor(gym$gender)
gym$level<-factor(gym$level,labels=c("débutant","intermédiaire","expert"))
summary(gym)


```

### Pour une variable qualitative
Nous allons dans un premier temps nous interesser a la répartition des deux variables qualitatives: level et gender

```{r}
#| echo: false
g1<-ggplot(gym, aes(x=gender))+ 
  geom_bar()+
  ylab("")+
  ggtitle("Effectifs")

df <- data.frame(group = levels(gym$level),
                 value = as.vector(table(gym$level))/nrow(gym))
g2<-ggplot(df, aes(x="", y=value, fill=group))+
  geom_bar(width = 1, stat = "identity")+ 
  coord_polar("y", start=0)+ 
  theme(legend.position="bottom")

grid.arrange(g1,g2,ncol=2)
```
### Pour une variable quantitative

nous allons maintenant analyser les variables quantitatives du jeux de donnée.
```{r}
#| echo: false
gymx1<-melt(gym[,-c(1,3,4,5,7,8)])
g3=ggplot(gymx1,aes(x=variable,y=value))+
  geom_boxplot()
gymx2<-melt(gym[,-c(1,2,5,6,9)])
g5=ggplot(gymx2,aes(x=variable,y=value))+
  geom_boxplot()


g4=ggplot(gym,aes(y=calories))+
  geom_boxplot()

grid.arrange(g3,g5,g4,ncol=3)
```
Ces graphiques en boîtes illustrent la tendance centrale (médiane), la dispersion (écart interquartile) ainsi que la présence de valeurs aberrantes pour plusieurs variables d'un ensemble de données. Ils permettent de souligner une forte variabilité pour le poids et les calories, et une plus grande concentration pour la taille, l'IMC et la matière grasse.

Nous allons maintenant représenter la variable Weight pour mieux observer cette disparité

```{r}
#| echo: false
ggplot(gym,aes(x=weight))+
  geom_histogram(aes(y=..density..),bins=15,color="black", fill="skyblue")+
  ggtitle("Histo. des fréquences")+
  ylab("Density")+xlab("weight")+

geom_density(color = "red", linewidth = 1) +
  labs(title = "Histogramme de Densité du Poids",
       x = "Poids (kg)",
       y = "Densité") +
  theme_minimal()
```
Sur cet histogramme de densité, nous pouvons observer que la majorité des adhérents de la salle de sport a un poids compris entre 50 et 90 kg. On note également la présence de quelques personnes ayant un poids plus élevé dans l'échantillon (jusqu'à 130kg). 



## analyse bidimensionnel
### entre 2 variables qualitatives

Nous nous intéressons dans cette partie a la corrélation deux variables qualitatives **level** et **gender**.

```{r} 
#| echo: false
# Crée la table de contingence
table_gym <- table(gym$gender, gym$level)

profils_lignes <- prop.table(table_gym, margin = 1)



mosaicplot(table_gym,
           main = "Profils-lignes : Répartition de niveau par genre",
           xlab = "Proportion de niveau conditionnelle",
           ylab = "genre",
           color = TRUE,
           las = 1, 
           cex.axis = 0.8)
           

```


Nous avons décidé de représenter la répartition de niveau par genre car il est plus pertinent que la répartition de genre par niveau.
Pour les femmes comme pour les hommes, le niveau débutant et le niveau intermédiaire sont les plus fréquents, tandis que le niveau expert est le moins fréquent. Les proportions entre débutant, intermédiaire et expert semblent suivre une tendance assez similaire pour les deux genres.

### entre une variable quantitative une variable qualitative 
### entre 2 variables quantitatives

```{r}
#| echo: false
corrplot(cor(gymq),
         method = "ellipse",
         type = "upper",
         order = "hclust",
         title = "Matrice de Corrélation ",
         mar = c(0, 0, 1, 0), 
         tl.cex = 0.8,
         number.cex = 0.6)
```

Cette visualisation représente les coefficients de corrélation de Pearson entre les variables quantitatives du jeu de données.
L'association la plus forte est observée entre la durée de l'entraînement et les calories brûlées (dépendance quasi-parfaite).Nous pouvons également observer une forte corrélation positive entre l'imc et le poids.
La variable fat est fortement corrélée négativement avec duration, calories et water. 

Nous allons maintenant explorer graphiquement certaines de ces corrélations bidimensionnelles.

```{r}
#| echo: false
g1=ggplot(gym, aes(x = duration, y = calories)) +
  geom_point() +                      
  geom_smooth(method = "lm") +         
  labs(title = "Calories brûlées en fonction de la Durée",
       x = "Durée",
       y = "Calories") 
g2=ggplot(gym, aes(x = duration, y = fat)) +
  geom_point() +                      
  geom_smooth(method = "lm") +         
  labs(title = "graisse corporel en fonction de la durée",
       x = "durée",
       y = "graisse") 

grid.arrange(g1,g2,ncol=2)

```
Ce graphique confirme la très forte corrélation entre les variables **duration** et **calories**. Ces observations ne sont pas étonnates car La dépense énergétique (calories) est, par définition physique, une fonction du temps. 


... a analyser


# analyse en composante principale (ACP)

On a la possiblité de réaliser une ACP qu'on appelle centrée ou bien centrée-réduite.

Comme son nom l'indique, la première consiste à utiliser des valeurs centrées (même moyenne à 0) et la deuxième, en plus d'avoir une moyenne à 0, réduit les valeurs pour avoir un même ordre de grandeur entre toutes les valeurs.
On utilise pour centrer et réduire la fonction scale.



```{r}
#on centre les valeurs
gymC<-scale(gym[,-c(1,8)],center=TRUE, scale=FALSE)
```

```{r}
respcaC<-PCA(gym,quali.sup=c(1,8),scale.unit = F,graph=F)
respcaC$eig
gg1<-fviz_eig(respcaC)
   
```

```{r}
#/echo:true
respca<-PCA(gym,quali.sup=c(1,8),scale.unit = T,graph=F)
respca$eig
gg2<-fviz_eig(respca)
#/echo: false
grid.arrange(gg1,gg2,ncol=2)
```
La figure .. est centrée et la.. réduite. On remarque que dans la première, une dimension(cad une variable) s'exprime beaucoup trop et empêche la lecture des autres. Quand on réalise une ACP réduite, il devient alors possible de lire le reste des variables.
On va donc continuer l'analyse sur une ACP centrée réduite.

On observe à présent les COMPOSANTES PRINCIPALES et leur pourcentage d'inertie et inertie cumulative. On va s'intéresser aux 3 premières dimensions, car leur inertie cumulative est à 85,88%. Valeur qui nous permet de ne pas perdre beaucoup d'information, et de diminuer drastiquement la dimension des données. On pourra comparer avec une analyse avec la dim4 inluse, afin de vérifier que les informations importantes sont bien présentent dans notre modèle.

```{r}
respca$eig
```
Figure.. Graphe des individus dans le premier plan factoriel (dim1 et 2)et les suivants plans factoriels (dim1,3 et dim2,3)


```{r}
# A COMPLETER
p1<-fviz_pca_ind(respca,geom="point")
p2<-fviz_pca_ind(respca,axes=c(1,3),geom="point")
p3<-fviz_pca_ind(respca,axes=c(2,3),geom="point")
grid.arrange(p1,p2,p3,ncol=2)
```
Figure... On voit que pour une centrée tout court on ne visualise rien du tout. //à pas mettre sur rapport.
```{r}


grid.arrange(fviz_pca_var(respca),fviz_pca_var(respcaC),ncol=2)
```
INTERPRÉTATIONS FINALES
PARLER PLUS DES MÉTAVARIABLES
# Références

